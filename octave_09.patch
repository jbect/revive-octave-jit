# HG changeset patch
# User Julien Bect <jbect@users.sourceforge.net>
# Date 1500615164 -7200
#      Fri Jul 21 07:32:44 2017 +0200
# Node ID 688e6041d332a44746fa2c963a076d91d1cdb239
# Parent  7fa04c3e7da70c8ade82c4377037e2964c21be5a
jit: Convert llvm::Function::arg_iterator to pointer explicitely

* libinterp/corefcn/jit-typeinfo.cc: Convert llvm::Function::arg_iterator to
  pointer explicitely.  Implicit conversion has been removed in LLVM 3.8.0.
* libinterp/corefcn/pt-jit.cc: Idem.

diff -r 7fa04c3e7da7 -r 688e6041d332 libinterp/parse-tree/jit-typeinfo.cc
--- a/libinterp/parse-tree/jit-typeinfo.cc	Sat Nov 04 22:13:03 2017 +0100
+++ b/libinterp/parse-tree/jit-typeinfo.cc	Fri Jul 21 07:32:44 2017 +0200
@@ -725,9 +725,9 @@
     for (size_t i = 0; i < idx; ++i, ++iter);
 
     if (args[idx]->pointer_arg (call_conv))
-      return builder.CreateLoad (iter);
+      return builder.CreateLoad (&*iter);
 
-    return iter;
+    return &*iter;
   }
 
   void
@@ -744,7 +744,7 @@
 
         if (sret ())
           {
-            builder.CreateStore (rval, llvm_function->arg_begin ());
+            builder.CreateStore (rval, &*(llvm_function->arg_begin ()));
             builder.CreateRetVoid ();
           }
         else
diff -r 7fa04c3e7da7 -r 688e6041d332 libinterp/parse-tree/pt-jit.cc
--- a/libinterp/parse-tree/pt-jit.cc	Sat Nov 04 22:13:03 2017 +0100
+++ b/libinterp/parse-tree/pt-jit.cc	Fri Jul 21 07:32:44 2017 +0200
@@ -1330,7 +1330,7 @@
         prelude = llvm::BasicBlock::Create (context, "prelude", function);
         builder.SetInsertPoint (prelude);
 
-        llvm::Value *arg = function->arg_begin ();
+        llvm::Value *arg = &*(function->arg_begin ());
         for (size_t i = 0; i < argument_vec.size (); ++i)
           {
             llvm::Value *loaded_arg = builder.CreateConstInBoundsGEP1_32 (arg, i);
